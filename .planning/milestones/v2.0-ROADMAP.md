# Milestone v2.0: Analysis Upgrades

**Status:** SHIPPED 2026-01-11
**Phases:** 5-7 (including decimal phases 5.1, 5.2)
**Total Plans:** 4 + 1 validation session

## Overview

Make analysis faster and richer so the feedback loop tightens. Culminates in real-world validation to verify improvements translate to better outcomes.

## Phases

### Phase 5: Performance Optimization

**Goal**: Profile psychoacoustic metrics, parallelize serial bottleneck, target sub-5s full analysis
**Depends on**: v1.1 complete
**Plans**: 1 plan

Plans:
- [x] 05-01: Performance profiling and benchmarking

**Details:**
- Profiled analyze pipeline with cProfile
- Identified MoSQITo loudness_zwtv as dominant bottleneck (~900ms of ~1100ms)
- Tested parallelization (ProcessPoolExecutor, ThreadPoolExecutor) — both slower than serial
- Established baselines: sub-5s for 1-4 second audio
- Created profiling and benchmark scripts

### Phase 5.1: CLI Iterate Command (INSERTED)

**Goal**: Single `audioloop iterate` command for render→analyze→play loop with inline SC code support
**Depends on**: Phase 5 (learnings from performance testing)
**Plans**: 1 plan

Plans:
- [x] 5.1-01: Add iterate command with inline SC code support

**Details:**
- Unified render→analyze→play workflow in single invocation
- `--code` flag for inline SuperCollider code (no temp files needed)
- JSON output by default (Claude is primary user)
- Audio playback warning with 1-second delay
- 15 tests for iterate command

**Context**: Real-world testing revealed orchestration overhead (multiple tool calls, process startups) is the actual bottleneck, not analysis code.

### Phase 5.2: CLI Output UX Polish (INSERTED)

**Goal**: Improve human-readable output formatting - table borders, alignment, colors that work across terminals
**Depends on**: Phase 5.1 (iterate command exists)
**Plans**: 1 plan

Plans:
- [x] 5.2-01: Unified table styling with shared layout module

**Details:**
- Created layout.py with semantic style functions: num(), path(), up(), down(), same()
- Minimal design with box-drawing section headers
- Disabled Rich auto-highlighting (was coloring numbers unexpectedly)
- Unified styling across analyze and compare commands

### Phase 6: Spectrogram Visualization

**Goal**: PNG (stacked waveform/spectrogram/chroma) + ASCII energy bands + CLI integration
**Depends on**: Phase 5.1
**Plans**: 1 plan

Plans:
- [x] 06-01: Spectrogram PNG generation and ASCII frequency bands

**Details:**
- Stacked 3-subplot PNG: waveform, mel spectrogram, chromagram
- `--spectrogram` flag on analyze and iterate commands
- 6 frequency bands for ASCII visualization (sub/bass/low-mid/mid/high-mid/high)
- band_energies in JSON output for programmatic access

### Phase 7: Real-World Validation

**Goal**: Sound design sessions to verify the loop tightened - iteration speed, feedback richness, outcome quality
**Depends on**: Phase 6
**Plans**: N/A (validation session, not implementation)

**Details:**
- Session 1: IDM/Aphex-style beat generation
- Discovered tool flags Claude didn't know about (UX gap)
- Reference comparison workflow identified as most valuable
- Key insight: "Tool is diagnostic, not prescription"
- Metrics converged but sounds were still amateur — operator knowledge is the limiting factor

---

## Milestone Summary

**Decimal Phases:**
- Phase 5.1: CLI Iterate Command (inserted after Phase 5 for urgent workflow improvement)
- Phase 5.2: CLI Output UX Polish (inserted after Phase 5.1 for formatting issues)

**Key Decisions:**
- Serial computation retained — parallelization overhead exceeded benefit
- JSON output default for iterate command (Claude is primary user)
- Stacked 3-subplot spectrogram with shared x-axis
- 6 frequency bands matching audio engineering conventions
- Semantic style functions in layout.py (style by meaning, not color)

**Issues Resolved:**
- ANSI escape code rendering issues in human output
- Rich auto-highlighting coloring numbers unexpectedly

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

**Key Validation Insights:**
- The `iterate` command alone justified the v2.0 milestone
- Reference comparison workflow is powerful — consider first-class support
- Tool diagnoses but doesn't prescribe — operator production knowledge is critical
- "Analyze reference FIRST" should be standard workflow

---

_For current project status, see .planning/ROADMAP.md_
